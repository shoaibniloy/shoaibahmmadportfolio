<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Autonomous Pollination with 3D Printed Robotic Arm and Monocular Vision</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" rel="stylesheet">
    
    <style>
      :root {
        --bg-primary: #0d0d0d;
        --bg-secondary: #111111;
        --text-primary: #f5f5f5;
        --text-secondary: #cccccc;
        --accent-red: #e53935;
        --accent-red-dark: #c62828;
        --border-color: #333333;
        --highlight-bg: #1a1a1a;
      }

      body {
        background-color: var(--bg-primary);
        color: var(--text-primary);
        font-family: 'Poppins', sans-serif;
        line-height: 1.8;
      }

      .ftco-section, .content-section {
        background-color: var(--bg-primary);
        margin: 0;
        padding: 0;
      }

      .navbar {
        background-color: var(--bg-secondary) !important;
        border-bottom: 1px solid var(--border-color);
      }

      .navbar-brand {
        color: var(--accent-red) !important;
        font-weight: 700;
        font-size: 1.1rem;
      }

      .navbar-brand:hover {
        color: #ff6b6b !important;
      }

      .content-section {
        padding: 30px 20px;
      }

      h2, h4, h5, h6 {
        color: var(--accent-red);
        font-weight: 600;
        margin-top: 30px;
        margin-bottom: 16px;
      }

      h2 {
        font-size: 2.2rem;
        text-align: center;
        margin-bottom: 20px;
      }

      .lead {
        color: var(--text-secondary);
        text-align: center;
        font-size: 1.15rem;
        margin-bottom: 30px;
      }

      p, ul, ol {
        color: var(--text-primary);
        margin-bottom: 18px;
      }

      ul, ol {
        padding-left: 20px;
      }

      .section-divider {
        height: 1px;
        background: linear-gradient(to right, transparent, var(--border-color), transparent);
        margin: 50px 0;
      }

      .video-container {
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 12px 40px rgba(0,0,0,0.6);
        margin: 40px 0;
        border: 2px solid var(--accent-red);
      }

      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 0;
      }

      .tech-tag {
        display: inline-block;
        background: rgba(229, 57, 53, 0.15);
        color: var(--accent-red);
        padding: 6px 14px;
        border-radius: 25px;
        font-size: 0.88rem;
        margin: 6px 8px 6px 0;
        font-weight: 500;
        border: 1px solid rgba(229, 57, 53, 0.3);
      }

      .katex-display {
        margin: 22px 0;
        overflow-x: auto;
        padding: 12px 0;
        background: var(--highlight-bg);
        border-radius: 8px;
        border-left: 4px solid var(--accent-red);
      }

      .code-block {
        background: var(--highlight-bg);
        border: 1px solid var(--border-color);
        border-left: 4px solid var(--accent-red);
        border-radius: 8px;
        padding: 14px 18px;
        font-family: 'Courier New', monospace;
        font-size: 0.92rem;
        overflow-x: auto;
        margin: 20px 0;
        color: #ffdddd;
      }

      /* Image Slider */
      .image-slider {
        margin: 50px 0;
      }

      .slider-container {
        position: relative;
        max-width: 100%;
        margin: auto;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        border: 1px solid var(--border-color);
      }

      .slider {
        display: flex;
        transition: transform 0.5s ease;
      }

      .slide {
        min-width: 100%;
        position: relative;
      }

      .slide img {
        width: 100%;
        height: auto;
        max-height: 65vh;
        object-fit: contain;
        display: block;
        cursor: pointer;
        filter: brightness(0.92);
        transition: filter 0.3s;
      }

      .slide img:hover {
        filter: brightness(1.05);
      }

      .slide-caption {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(13,13,13,0.9));
        color: #fff;
        padding: 20px 15px 12px;
        font-size: 0.95rem;
        font-style: italic;
      }

      .slider-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0,0,0,0.6);
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        font-size: 1.8rem;
        cursor: pointer;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        transition: all 0.3s;
      }

      .slider-nav:hover {
        background: var(--accent-red);
        transform: translateY(-50%) scale(1.1);
      }

      .prev-btn { left: 15px; }
      .next-btn { right: 15px; }

      /* Lightbox */
      .lightbox {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.95);
        align-items: center;
        justify-content: center;
        padding: 20px;
        box-sizing: border-box;
      }

      .lightbox.active {
        display: flex;
      }

      .lightbox img {
        max-width: 95%;
        max-height: 90vh;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 0 40px rgba(0,0,0,0.8);
      }

      .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(229, 57, 53, 0.8);
        color: white;
        border: none;
        width: 60px;
        height: 60px;
        font-size: 2.2rem;
        cursor: pointer;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1001;
        transition: all 0.3s;
      }

      .lightbox-nav:hover {
        background: var(--accent-red);
        transform: translateY(-50%) scale(1.15);
      }

      .lightbox-prev { left: 30px; }
      .lightbox-next { right: 30px; }

      .lightbox-close {
        position: absolute;
        top: 30px;
        right: 30px;
        background: rgba(229, 57, 53, 0.8);
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        font-size: 1.8rem;
        cursor: pointer;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1001;
        transition: all 0.3s;
      }

      .lightbox-close:hover {
        background: #c62828;
        transform: scale(1.1);
      }
    </style>
  </head>
  <body>

    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar ftco-navbar-light site-navbar-target" id="ftco-navbar">
      <div class="container">
          <a class="navbar-brand" href="index.html">Go Back</a>
      </div>
    </nav>  

    <!-- Hero Video -->
    <section class="ftco-section">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-12">
            <div class="video-container">
              <iframe src="https://www.youtube.com/embed/w8g6eLM7Erg" title="Autonomous Pollination System - Full Demo" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <section class="content-section">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <h2>Autonomous Pollination with 3D Printed 6-DoF Robotic Arm and Monocular Vision</h2>
            <p class="lead">A high-precision, low-cost pollination robot using <strong>real-time 3D pose estimation</strong>, <strong>constrained PSO inverse kinematics</strong>, and <strong>EKF-smoothed servo control</strong> — achieving sub-centimeter accuracy with a single webcam and no external sensors.</p>

            <div class="section-divider"></div>

            <h4>System Architecture & Integration</h4>
            <p>The system integrates five core modules in a tightly coupled pipeline:</p>
            <ul>
              <li><strong>Vision Module</strong>: YOLOv8 + Kalman tracking → 3D localization</li>
              <li><strong>Localization Module</strong>: Monocular depth via area regression + radial normalization</li>
              <li><strong>Motion Planning</strong>: PSO-based IK with direction constraints</li>
              <li><strong>Control Module</strong>: EKF per servo + rate-limited trajectory execution</li>
              <li><strong>Interface</strong>: PyQt6 GUI with real-time 3D visualization (Matplotlib)</li>
            </ul>

            <div class="section-divider"></div>

            <h4>Computer Vision Pipeline — In-Depth</h4>

            <h5>1. Flower Detection (YOLOv8)</h5>
            <ul>
              <li><strong>Model</strong>: <code>yolo_apple.pt</code> — fine-tuned on 1,200 annotated yellow apple blossoms</li>
              <li><strong>Input</strong>: 640×360 RGB frames (resized from 1280×720 via letterboxing)</li>
              <li><strong>Inference</strong>: ONNX Runtime with CUDA EP (fallback to CPU)</li>
              <li><strong>Post-processing</strong>: NMS with IoU threshold 0.45, confidence ≥ 0.35</li>
            </ul>

            <h5>2. Multi-Object Tracking with Kalman Filter</h5>
            <p>Each track maintains a 9-state vector:</p>
            <div class="katex-display">
              \[\mathbf{x} = \begin{bmatrix} x \\ y \\ a \\ \dot{x} \\ \dot{y} \\ \dot{a} \\ \ddot{x} \\ \ddot{y} \\ \ddot{a} \end{bmatrix}\]
            </div>
            <ul>
              <li><strong>State Transition</strong>: Constant acceleration model (dt = 1/30s)</li>
              <li><strong>Measurement</strong>: Bounding box center (x,y), area \(a = w \times h\)</li>
              <li><strong>Data Association</strong>: Weighted cost: \( c = 0.7 \cdot (1 - \text{IoU}) + 0.3 \cdot (1 - \text{conf}) \)</li>
              <li><strong>Track Management</strong>: Age-based deletion after 90 missed frames</li>
            </ul>

            <h5>3. Monocular 3D Localization</h5>
            <p>Depth estimated via calibrated area-to-distance mapping:</p>
            <div class="katex-display">
              \[ d = a_2 a^2 + a_1 a + a_0 \]
            </div>
            <ul>
              <li><strong>Calibration</strong>: 150 samples at known distances (200–800mm)</li>
              <li><strong>Coefficients</strong>: \(a_2 = -1.203 \times 10^{-6}\), \(a_1 = 0.00187\), \(a_0 = 712.4\)</li>
              <li><strong>Radial Correction</strong>: 
                \[
                x_c = \frac{x - c_x}{f_x}, \quad y_c = \frac{y - c_y}{f_y}, \quad r = \sqrt{x_c^2 + y_c^2}
                \]
                \[
                \text{scale} = 1 + k_1 r^2 + k_2 r^4
                \]
              </li>
              <li><strong>Deprojection</strong>: 
                \[
                Z = d, \quad X = x_c \cdot Z \cdot \text{scale}, \quad Y = y_c \cdot Z \cdot \text{scale}
                \]
              </li>
            </ul>

            <div class="section-divider"></div>

            <h4>Robotic Arm Kinematics</h4>

            <h5>Forward Kinematics (DH Parameters)</h5>
            <p>6-DoF arm with non-standard joint offsets. Transformation from base to tip:</p>
            <div class="code-block">
              T = T_1(\theta_1) \cdot T_2(\theta_2) \cdot T_3(\theta_3) \cdot T_4(\theta_4) \cdot T_5(\theta_5) \cdot T_6(\theta_6) \cdot T_{\text{ext}}
            </div>
            <p>Where \(T_{\text{ext}}\) includes 40mm cotton bud along gripper centerline.</p>

            <h5>Inverse Kinematics via Constrained PSO</h5>
            <p>Objective: Minimize end-effector error with direction alignment:</p>
            <div class="katex-display">
              \[ f(\theta) = w_p \|\mathbf{p}_t - \mathbf{p}(\theta)\|_2 + w_d (1 - \hat{\mathbf{d}}_t \cdot \hat{\mathbf{d}}(\theta)) + w_r \|\theta - \theta_{\text{pref}}\|_2 \]
            </div>
            <ul>
              <li><strong>Particles</strong>: 30, inertia decay 0.99 → 0.4</li>
              <li><strong>Bounds</strong>: Per-servo physical limits + velocity constraints</li>
              <li><strong>Direction Weight</strong>: \(w_d = 15.0\) ensures approach vector alignment</li>
              <li><strong>Convergence</strong>: Stop if error < 2.5mm or 300 iterations</li>
            </ul>

            <h5>Servo Control with EKF</h5>
            <p>Each servo runs an independent EKF:</p>
            <div class="katex-display">
              \mathbf{x} = \begin{bmatrix} \theta \\ \dot{\theta} \end{bmatrix}, \quad
              \mathbf{F} = \begin{bmatrix} 1 & \Delta t \\ 0 & 1 \end{bmatrix}, \quad
              \mathbf{Q} = \begin{bmatrix} 0.001 & 0 \\ 0 & 0.001 \end{bmatrix}
            </div>
            <ul>
              <li><strong>Measurement</strong>: Direct angle from Arduino (noisy)</li>
              <li><strong>Prediction</strong>: Constant velocity model</li>
              <li><strong>Update Rate</strong>: 62.5 Hz</li>
            </ul>

            <div class="section-divider"></div>

            <h4>Autonomous Pollination Sequence (Detailed)</h4>
            <ol>
              <li><strong>Target Selection</strong>: Nearest unvisited flower in 3D space</li>
              <li><strong>Standoff Pose</strong>: 
                <ul>
                  <li>Target: \(\mathbf{p}_f - 120\mathbf{\hat{n}}\)</li>
                  <li>Direction: \(\mathbf{\hat{n}} = \frac{\mathbf{p}_f - \mathbf{p}_c}{\|\cdot\|}\)</li>
                  <li>PSO with direction constraint</li>
                </ul>
              </li>
              <li><strong>Contact Thrust</strong>: 
                <ul>
                  <li>Target: \(\mathbf{p}_f\) (exact)</li>
                  <li>Advance 18mm along \(\mathbf{\hat{n}}\)</li>
                  <li>Dwell: 300ms</li>
                </ul>
              </li>
              <li><strong>Retraction</strong>: Move -25mm along \(\mathbf{\hat{n}}\)</li>
              <li><strong>Reset</strong>: Return to preferred pose \(\theta_{\text{home}}\)</li>
            </ol>

            <div class="section-divider"></div>

            <!-- Image Slider -->
            <div class="image-slider">
              <h4 style="color: var(--accent-red); text-align: center;">System Visualizations</h4>
              <div class="slider-container">
                <button class="slider-nav prev-btn" onclick="moveSlide(-1)">❮</button>
                <button class="slider-nav next-btn" onclick="moveSlide(1)">❯</button>
                <div class="slider" id="imageSlider">
                  <div class="slide">
                    <img src="pollination (1).png" alt="Full system dashboard" onclick="openLightbox(0)">
                    <div class="slide-caption">Figure 1: Full system dashboard with real-time 3D visualization and servo controls</div>
                  </div>
                  <div class="slide">
                    <img src="pollination (2).png" alt="Real-time flower detection" onclick="openLightbox(1)">
                    <div class="slide-caption">Figure 2: Real-time flower detection with confidence filtering</div>
                  </div>
                  <div class="slide">
                    <img src="pollination (3).png" alt="3D visualization" onclick="openLightbox(2)">
                    <div class="slide-caption">Figure 3: 3D visualization with camera frustum and approach vector</div>
                  </div>
                  <div class="slide">
                    <img src="pollination (4).png" alt="IK solver interface" onclick="openLightbox(3)">
                    <div class="slide-caption">Figure 4: IK solver interface with direction and position constraints</div>
                  </div>
                  <div class="slide">
                    <img src="pollination (5).png" alt="Standoff pose" onclick="openLightbox(4)">
                    <div class="slide-caption">Figure 5: Pre-contact standoff pose (120mm)</div>
                  </div>
                  <div class="slide">
                    <img src="pollination (6).png" alt="Contact phase" onclick="openLightbox(5)">
                    <div class="slide-caption">Figure 6: Contact phase — 18mm thrust completed</div>
                  </div>
                  <div class="slide">
                    <img src="pollination (7).png" alt="EKF filtering" onclick="openLightbox(6)">
                    <div class="slide-caption">Figure 7: EKF filtering on servo angles (real vs filtered)</div>
                  </div>
                  <div class="slide">
                    <img src="pollination (8).png" alt="Trajectory playback" onclick="openLightbox(7)">
                    <div class="slide-caption">Figure 8: Recorded trajectory with spline playback</div>
                  </div>
                  <div class="slide">
                    <img src="pollination (9).png" alt="Sim vs real" onclick="openLightbox(8)">
                    <div class="slide-caption">Figure 9: Simulation vs real-world pose matching</div>
                  </div>
                  <div class="slide">
                    <img src="pollination (10).png" alt="Autonomous sequence" onclick="openLightbox(9)">
                    <div class="slide-caption">Figure 10: End-to-end autonomous pollination of 5 flowers</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="section-divider"></div>

            <h4>Performance Metrics</h4>
            <ul>
              <li><strong>Localization Accuracy</strong>: ±8.3mm (RMSE) over 200–600mm range</li>
              <li><strong>IK Solve Time</strong>: 42ms avg (30 particles, CUDA)</li>
              <li><strong>End-Effector Precision</strong>: ±4.1mm in contact phase</li>
              <li><strong>Cycle Time</strong>: 4.8s per flower (detect → pollinate → reset)</li>
              <li><strong>Success Rate</strong>: 96% (144/150 flowers, manual inspection)</li>
            </ul>

            <div class="section-divider"></div>

            <h4>Core Technologies</h4>
            <div>
              <span class="tech-tag">YOLOv8</span>
              <span class="tech-tag">ONNX Runtime</span>
              <span class="tech-tag">CUDA</span>
              <span class="tech-tag">Kalman Filter</span>
              <span class="tech-tag">EKF</span>
              <span class="tech-tag">PSO</span>
              <span class="tech-tag">PyTorch</span>
              <span class="tech-tag">PyQt6</span>
              <span class="tech-tag">Matplotlib 3D</span>
              <span class="tech-tag">Akima Spline</span>
              <span class="tech-tag">Serial Comm</span>
              <span class="tech-tag">QThread</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
      <button class="lightbox-close" onclick="closeLightbox()">×</button>
      <button class="lightbox-nav lightbox-prev" onclick="changeLightboxImage(-1)">❮</button>
      <button class="lightbox-nav lightbox-next" onclick="changeLightboxImage(1)">❯</button>
      <img id="lightboxImage" src="" alt="Enlarged view">
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>

    <script>
      // Auto-render KaTeX
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\[", right: "\\]", display: true},
            {left: "\\(", right: "\\)", display: false}
          ],
          throwOnError: false
        });
      });

      // Slider
      let currentSlide = 0;
      const slides = document.querySelectorAll('.slide');
      const totalSlides = slides.length;

      function showSlide(n) {
        currentSlide = (n + totalSlides) % totalSlides;
        const slider = document.getElementById('imageSlider');
        slider.style.transform = `translateX(-${currentSlide * 100}%)`;
      }

      function moveSlide(direction) {
        showSlide(currentSlide + direction);
      }

      // Lightbox
      let lightboxIndex = 0;
      const lightbox = document.getElementById('lightbox');
      const lightboxImg = document.getElementById('lightboxImage');

      function openLightbox(index) {
        lightboxIndex = index;
        lightboxImg.src = slides[index].querySelector('img').src.replace(/(\.png)$/, '_high$1'); // optional high-res
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
      }

      function closeLightbox() {
        lightbox.classList.remove('active');
        document.body.style.overflow = 'auto';
      }

      function changeLightboxImage(direction) {
        lightboxIndex = (lightboxIndex + direction + totalSlides) % totalSlides;
        lightboxImg.src = slides[lightboxIndex].querySelector('img').src.replace(/(\.png)$/, '_high$1');
      }

      // Close on click outside
      lightbox.addEventListener('click', function(e) {
        if (e.target === lightbox) closeLightbox();
      });

      // Keyboard navigation
      document.addEventListener('keydown', function(e) {
        if (lightbox.classList.contains('active')) {
          if (e.key === 'ArrowLeft') changeLightboxImage(-1);
          if (e.key === 'ArrowRight') changeLightboxImage(1);
          if (e.key === 'Escape') closeLightbox();
        } else {
          if (e.key === 'ArrowLeft') moveSlide(-1);
          if (e.key === 'ArrowRight') moveSlide(1);
        }
      });

      // Initialize
      showSlide(0);
    </script>
  </body>
</html>